<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval';">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ATV Remote</title>
    <link rel="stylesheet" href="css/loaders.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pure-min.css">
    <link rel="stylesheet" href="css/all.css">
    <link rel="stylesheet" id="s2style-sheet" href="css/select2-inverted.css">
    <script>
        window.jQuery = window.$ = require('jquery');
        require('./js/select2.min.js')($)
    </script>
    <script src="js/tippy-headless.umd.min.js"></script>
    <script src="js/loader.js"></script>
</head>

<body>
        <!-- Top bar (hidden, preserving exitLink for JS compatibility) -->
        <button id="exitLink" style="display:none"></button>

        <!-- Header -->
        <div class="center" id="keyboardButtonDiv">
            <div class="topText">
                <span id="topTextHeader">ATV Remote<span id="connectionDot" class="connection-dot"></span></span>
            </div>
            <div id="topTextKBLink" style="display:none"></div>

            <div id="initText">
                <p>Starting up...</p>
                <div style="text-align:center">
                    <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
                </div>
            </div>
        </div>

        <div id="main">
            <!-- Pairing flow -->
            <div id="addNewElements">
                <div id="loader">
                    <div id="pairingLoader"></div>
                </div>
                <div id="pairingElements">
                    <div id="results">
                        <div class="pair-section">
                            <p class="pair-label">Select a device to pair</p>
                            <select id="atv_picker"></select>
                        </div>
                    </div>
                    <div id="pairCodeElements">
                        <div class="pair-section">
                            <div class="pair-step-badge">Step <span id="pairStepNum">1</span> of 2 · <span id="pairProtocolName">AirPlay</span></div>
                            <p class="pair-label">Enter the code shown on your Apple TV</p>
                            <input id="pairCode" type="text" class="pair-code-input" maxlength="4" placeholder="0000" inputmode="numeric" autocomplete="off" />
                            <button id="pairButton" class="pair-submit-btn">Continue</button>
                        </div>
                    </div>
                    <button id="cancelPairing" class="pair-cancel-btn">Cancel</button>
                </div>
            </div>

            <!-- Remote controls -->
            <div id="runningElements">
                <div id="keyMapElement"></div>

                <table class="pythonError">
                    <tr>
                        <td><span class="pythonErrorHeader">Python not found</span></td>
                    </tr>
                    <tr>
                        <td>You must install Python to use this program. Visit python.org to download Python, and make sure to select the option to add Python to the path.</td>
                    </tr>
                </table>

                <!-- Remote body -->
                <div class="remote-body">
                    <!-- Inline text input (shown when ATV has text field focused) -->
                    <div id="inline-keyboard" style="display:none">
                        <input type="text" id="inlineTextInput" class="large-text-input" placeholder="Type to search...">
                        <span class="inline-kb-hint">Text input active on Apple TV</span>
                    </div>
                    <div id="companion-hint" class="companion-hint" style="display:none">
                        <i class="fas fa-keyboard"></i> Keyboard auto-activates with text fields
                    </div>

                    <!-- Swipeable touchpad -->
                    <div id="touchpad">
                        <div class="touchpad-hint">
                            <i class="fas fa-hand-pointer"></i>
                            <span>swipe or tap</span>
                        </div>
                        <div class="touchpad-arrow touchpad-arrow-up"><i class="fas fa-chevron-up"></i></div>
                        <div class="touchpad-arrow touchpad-arrow-down"><i class="fas fa-chevron-down"></i></div>
                        <div class="touchpad-arrow touchpad-arrow-left"><i class="fas fa-chevron-left"></i></div>
                        <div class="touchpad-arrow touchpad-arrow-right"><i class="fas fa-chevron-right"></i></div>
                    </div>

                    <!-- Media controls row -->
                    <div class="media-row">
                        <div data-key="menu" data-tippy-content="Menu (Esc) · G for Top Menu" class="directionCircle media-btn"><span class='keyText'><i class="fas fa-arrow-left"></i></span><span class='keyTextAlt'>Esc</span></div>
                        <div data-key="play_pause" data-tippy-content="Play / Pause" class="directionCircle media-btn play-btn"><span class='keyText'><i class="fas fa-play"></i></span><span class='keyTextAlt'>Space</span></div>
                        <div data-key="home" data-tippy-content="Home (T) · L for Long-press" class="directionCircle media-btn"><span class='keyText'><i class="fas fa-tv"></i></span><span class='keyTextAlt'>T</span></div>
                    </div>

                    <!-- Secondary controls row -->
                    <div class="secondary-row">
                        <div data-key="skip_backward" data-tippy-content="Skip Back" class="directionCircle secondary-btn"><span class='keyText'><i class="fas fa-backward"></i></span><span class='keyTextAlt'>[</span></div>
                        <div data-key="volume_down" data-tippy-content="Lower Volume" class="directionCircle secondary-btn vol-btn"><span class='keyText'><i class="fas fa-volume-down"></i></span><span class='keyTextAlt'>-</span></div>
                        <div data-key="volume_up" data-tippy-content="Raise Volume" class="directionCircle secondary-btn vol-btn"><span class='keyText'><i class="fas fa-volume-up"></i></span><span class='keyTextAlt'>+</span></div>
                        <div data-key="skip_forward" data-tippy-content="Skip Forward" class="directionCircle secondary-btn"><span class='keyText'><i class="fas fa-forward"></i></span><span class='keyTextAlt'>]</span></div>
                    </div>
                    <div class="shortcut-hint">Hold <kbd>&#x2325;</kbd> to show keyboard shortcuts</div>
                </div>
            </div>

            <h2 id="statusText"></h2>
        </div>
    <script src="web_remote.js"></script>
    <script src="atv_remote.js"></script>
    <script>
        tippy('[data-tippy-content]', {
            delay: [400, 0],
            placement: 'top',
            onShow(instance) {
                instance.popper.style.visibility = 'visible';
            },
            onHide(instance) {
                instance.popper.style.visibility = 'hidden';
            },
            render(instance) {
                const popper = document.createElement('div');
                popper.className = 'atv-tooltip';
                popper.style.visibility = 'hidden';
                const content = document.createElement('div');
                content.className = 'atv-tooltip-content';
                content.textContent = instance.props.content;
                popper.appendChild(content);
                return { popper, onUpdate(prevProps, nextProps) {
                    if (prevProps.content !== nextProps.content) {
                        content.textContent = nextProps.content;
                    }
                }};
            },
        });
    </script>
</body>

</html>
